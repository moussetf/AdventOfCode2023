!(1â‰¡â‰ ) â€¢args

inputâ†>â€¢FLines âŠ‘â€¢args

graphâ€¿digraphâ†{
	Fâ†Â»âˆ¾Â¨Â«âˆ¾Â¨Â»Ë˜âˆ¾Â¨Â«Ë˜ # NSWE shifts
	indicesâ†(<Ë˜4â€¿2âŠ¸â¥Š)Â¨Fâ†•â‰¢input
	cliffsâ†Â¬"v^><"âŠ¸=Â¨ input
	a â† input {Â¬âŠ‘ğ•¨âˆŠ".><^v"?4â¥Š0; Â¬ğ•©âˆŠ"# "}Â¨ (F input) # Select all neighbours
	b â† input {Â¬âŠ‘ğ•¨âˆŠ".><^v"?4â¥Š0; (ğ•©='.')âˆ¨(ğ•©="^v<>")}Â¨ (F input) # Select only allowed neighbours
	âŸ¨a/Â¨indices, b/Â¨indicesâŸ©
}

nodesâ†(âŸ¨âŸ©âŠ¸â‰¢Â¨)âŠ¸(/â—‹â¥Š)âŸœ(â†•â‰¢) graph
startâ†âŠ‘(0=âŠ‘)Â¨âŠ¸/ nodes
endâ†âŠ‘((Â¯1+â‰ graph)=âŠ‘)Â¨âŠ¸/ nodes

# Generic DFS
_dfs_â†{
	graph F _dfs_ Init start:
		vâ†1Â¨graph â‹„ dataâ†InitÂ¨â†•â‰¢graph
		{ v 0Ë™âŒ¾(ğ•©âŠ¸âŠ‘)â†©
		nbsâ†ğ•©âŠ‘graph
		ğ•ŠÂ¨ (âŠ‘âŸœv)âŠ¸/nbs 
		ğ•© âŠ‘ data (ğ•© F nbsâŠ‘data)Ë™âŒ¾(ğ•©âŠ¸âŠ‘)â†©
 } start
}

â€¢Show digraph { n ğ•Š ds:  { nâ‰¡end?0; 1+âŒˆÂ´ds } } _dfs_ Â¯âˆ start

# For part 2, create a simplfied graph by contracting the bare paths
sgraphâ€¿sdistâ†{
	gâ†âŸ¨âŸ©Â¨graph â‹„ dâ†âŸ¨âŸ©Â¨graph
	digraph {
		n ğ•Š data: data (â‰¢Â¨âŸœÂ¯âˆ)âŠ¸/â†© â‹„  {
			2â‰¡â‰ nâŠ‘graph? (+âŸœ1)âŒ¾âŠ‘âŠ‘data;
			nbsâ†1âŠ¸âŠ‘Â¨data
			distsâ†âŠ‘Â¨data
			g (âˆ¾âŸœnbs)âŒ¾(nâŠ¸âŠ‘)â†©
			d (âˆ¾âŸœdists)âŒ¾(nâŠ¸âŠ‘)â†©
			{ğ•Š lâ€¿m:
				g (âˆ¾âŸœ(<n))âŒ¾(mâŠ¸âŠ‘)â†©
				d (âˆ¾âŸœ(<l))âŒ¾(mâŠ¸âŠ‘)â†© }Â¨ data
			1â€¿n
		 }
	} _dfs_ Â¯âˆ start
	gâ€¿d
}

â€¢Show {
	vâ†1Â¨input
	bestâ†Â¯âˆ
	0 {
		l Search n:
			nâ‰¡start? best lâŠ¸âŒˆâ†©;
		l Search n:
			v 0Ë™âŒ¾(nâŠ¸âŠ‘)â†©
			cdsâ†nâŠ‘sgraph
			distâ†nâŠ‘sdist
			maskâ†cdsâŠ‘v
			(l+mask/dist) SearchÂ¨ mask/cds
			v 1Ë™âŒ¾(nâŠ¸âŠ‘)â†©
	} end
	best
}
