brickâ†{
	# Bricks are vectors (x0 y0 z0 x1 y1 z1 idx)
	Idxâ‡6âŠ¸âŠ‘
	XMinâ‡(0âŠ¸âŠ‘)âŒŠ(3âŠ¸âŠ‘) â‹„ YMinâ‡(1âŠ¸âŠ‘)âŒŠ(4âŠ¸âŠ‘) â‹„ ZMinâ‡(2âŠ¸âŠ‘)âŒŠ(5âŠ¸âŠ‘)
	XMaxâ‡(0âŠ¸âŠ‘)âŒˆ(3âŠ¸âŠ‘) â‹„ YMaxâ‡(1âŠ¸âŠ‘)âŒˆ(4âŠ¸âŠ‘) â‹„ ZMaxâ‡(2âŠ¸âŠ‘)âŒˆ(5âŠ¸âŠ‘)
	Heightâ‡1+ZMax-ZMin
	# The projection to the xy plane will be important
	Footprintâ‡0â€¿1âŠ¸âŠ {â¥Š(<ğ•¨)+â†•ğ•©-ğ•¨-1} 3â€¿4âŠ¸âŠ
}

# Parse input
Splitâ†((1-Ëœ((1++`)âˆ§Â¬))âˆ˜âˆŠËœ)âŠ”âŠ¢
ParseIntâ†+Â´(10â‹†(â†•â‰ ))Ã—(âŒ½(-âŸœ'0'))
bricksâ†âˆ¾Â¨âŸœ(â†•â‰ ) (ParseIntÂ¨ 6âŠ¸â†‘âˆ˜",~"âŠ¸Split)Â¨ â€¢FLines âŠ‘âŠ"sample" â€¢args

# Build a matrix with m(ij)=1 iff brick i supports brick j
mXâ†1 + âŒˆÂ´brick.XMaxÂ¨ bricks
mYâ†1 + âŒˆÂ´brick.YMaxÂ¨ bricks
supportMat â† 2âŠ‘ âŸ¨mXâ€¿mYâ¥Š0,mXâ€¿mYâ¥ŠÂ¯1,(â‰ bricks)â€¿(â‰ bricks)â¥Š0âŸ© {
	b ğ•Š âŸ¨heights,highest,supportMatâŸ©:
		idxâ†brick.Idx b â‹„ fpâ†brick.Footprint b
		zâ†fpâŠ¸âŠ‘ heights â‹„ zmaxâ†âŒˆÂ´z
		suppâ†â‹ˆâŸœidxÂ¨ (Â¯1âŠ¸â‰ âŠ¸/) Â¯1+(z=zmax)âˆ§(1+fpâŠ¸âŠ‘highest)
		âŸ¨ (zmax + brick.Height b)Â¨âŒ¾(fpâŠ¸âŠ‘) heights â‹„ idxÂ¨âŒ¾(fpâŠ¸âŠ‘) highest â‹„ 1Â¨âŒ¾(suppâŠ¸âŠ‘)supportMat âŸ©
}Â´(â’brick.ZMinÂ¨)âŠ¸âŠ bricks

# A brick is a disintegrable iff every brick it supports is also supported by
# least one other brick, that is, twice the row in the matrix is at most the
# sum of the all the rows:
â€¢Show +Â´(2âŠ¸Ã—)âŠ¸(âˆ§Â´âˆ˜â‰¤â‰1â€¿âˆ)âŸœ(+Ë) supportMat
# The "super" of a set of blocks is the set of blocks supported wholly
# on blocks in this set.
Superâ†(<Ë˜â‰supportMat)(âˆ§Â´â‰¤)Â¨<
NumFalling â† (Â¯1+(+Â´)) âˆ˜ (1âŠ¸âŠ‘) âˆ˜ ({
		ğ•Š âŸ¨Â·, setâŸ©: new â† (âˆ¨Ë set/supportMat) âˆ§ Super set â‹„ âŸ¨âˆ¨Â´new>set, setâˆ¨newâŸ©
		} â€¢_while_ âŠ‘) âˆ˜ {âŸ¨1,ğ•©=â†•â‰ bricksâŸ©}
â€¢Show +Â´ NumFallingÂ¨ â†•â‰ bricks
