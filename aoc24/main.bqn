!(1â‰¡â‰ ) â€¢args
Splitâ†(â‰¢âŸœâŸ¨âŸ©)Â¨âŠ¸/ ((1-Ëœ(1++`)âˆ§Â¬)âˆŠËœ)âŠ”âŠ¢
ParseIntâ†(1+Â¯2Ã—('-'=âŠ‘)) Ã— (+Â´(10â‹†(â†•â‰ ))Ã—(âŒ½(-âŸœ'0')))âˆ˜((â‰ âŸœ'-')âŠ¸/)
inputâ†> ParseIntÂ¨âˆ˜(", @"âŠ¸Split)Â¨ â€¢FLines âŠ‘â€¢args
posâ†3â†‘Ë˜input
velâ†3â†“Ë˜input

# LU decomposition
Elimâ†{
	ğ•¨ ğ•Š âŸ¨p,l,uâŸ©: 0â‰¡ğ•¨â€¿ğ•¨âŠ‘u? âŸ¨p,lâˆ¾Ë˜âŠâŠ¢(1Ë™âŒ¾(ğ•¨âŠ¸âŠ‘)0Ë™Ë˜u),uâŸ©;
	ğ•¨ ğ•Š âŸ¨p,l,uâŸ©: vâ†(ğ•¨â†“ğ•¨âŠ‘Ë˜u)Ã·ğ•¨â€¿ğ•¨âŠ‘u â‹„ âŸ¨p,lâˆ¾Ë˜âŠâŠ¢(ğ•¨â¥Š0)âˆ¾v,u-((ğ•¨â¥Š0)âˆ¾Â»Â«v)Ã—âŒœğ•¨âŠuâŸ©
}
Permâ†{
	ğ•¨ ğ•Š âŸ¨p,l,uâŸ©: 0â‰¡ğ•¨â€¿ğ•¨âŠ‘u?
		qâ†(â†•ğ•¨)âˆ¾ğ•¨+â’| ğ•¨â†“ğ•¨ âŠ‘Ë˜u
		mâ†qâŠu
		âŸ¨qâŠp,qâŠâŠâŠ¢l,mâŸ©;
	ğ•©
}
LUâ†{ âŸ¨â†•â‰ ğ•©,âŸ¨âŸ©,ğ•©âŸ© (âŠ£ Elim Perm)Â´ âŒ½â†•â‰ ğ•© }

# Solve a non-singular linear system
Subâ†{
	b ğ•Š idxâ€¿l:
		(0â¥ŠËœâ‰ b) {
			i ğ•Š ğ•©: "Singular matrix"!0â‰¢(iâ€¿i)âŠ‘l â‹„ (((iâŠ‘b)-+Â´ğ•©Ã—iâŠl)Ã·((iâ€¿i)âŠ‘l))Ë™âŒ¾(iâŠ¸âŠ‘) ğ•©
		}Â´ idx
}
Solveâ†{ ğ•¨ ğ•Š ğ•©: pâ€¿lâ€¿uâ†LU ğ•© â‹„ bâ†pâŠğ•¨ â‹„ (b Sub (âŒ½â†•â‰ ğ•¨)â€¿l) Sub (â†•â‰ ğ•¨)â€¿u }

â€¢Show {
	Rot90â†1â€¿Â¯1Ã—âŒ½
	Crossingâ†{ pâ€¿v ğ•Š qâ€¿w: vtâ†Rot90 v â‹„ wtâ†Rot90 w â‹„ (+ËË˜ (pÃ—vt)â‰qÃ—wt) SolveâŠâˆâ€¿âˆ vtâ‰wt }
	IsFutureâ†{ pâ€¿v ğ•Š q: âˆ§Â´ 0â‰¤(q-p)Ã·v }
	Inâ†{âŸ¨min,maxâŸ© ğ•Š ğ•©: âˆ§Â´(min<ğ•©)âˆ§(ğ•©â‰¤max) }
	taâ†("sample"â‰¡âŠ‘â€¢args)â—¶âŸ¨200000000000000â€¿400000000000000,7â€¿27âŸ© @
	hs2dâ†(2â†‘Ë˜pos)â‹ˆË˜(2â†‘Ë˜vel)
	csâ†CrossingâŒœËœ<Ë˜ hs2d
	dsâ†(â‰âˆ§âŠ¢) hs2dâŠ¸(((<âŠ£)IsFutureÂ¨âŠ¢)Ë˜)cs
	2 Ã·Ëœâ‰  taâŠ¸InÂ¨âŠ¸/ ds/â—‹â¥Šcs
}

â€¢Show {
	# The idea is that three hailstones can fully determine the solution. The
	# appropriate system of quadratic equations for the 9-element vector pâˆ¾vâˆ¾t
	# can (sometimes) be solved using Newton's method. This is repeatedly
	# attempted with random initial conditions and random triples of hailstones
	# until a solution is found.
	epsâ†0.0000001
	maxstepsâ†100
	matâ†3â€¿9â¥Š1â€¿0â€¿0â€¿1â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0
	+Â´3â†‘âŠ‘ {
		ğ•¤ â‹„ sâ†3âŠ¸â€¢rand.Subset â‰ input â‹„ p3â†sâŠpos â‹„ v3â†sâŠvel â‹„ startâ†â€¢rand.RangeÂ¨ 9â¥Š1000
		Fâ†{ ğ•Š vec: pâ€¿vâ€¿tâ†<Ë˜3â€¿3â¥Švec â‹„ â¥Š (tÃ—(3â€¿3â¥Šv)-v3) + (3â€¿3â¥Šp)-p3 }
		DFâ†{ ğ•Š vec: pâ€¿vâ€¿tâ†<Ë˜3â€¿3â¥Švec â‹„ â‰matâˆ¾(matÃ—â‰1â€¿1 3/t)âˆ¾(3â€¿9â¥Š12âŠ¸â†‘âŒ¾â‰(3â€¿3â¥Šv)-v3) }
		iâ†0
		xâ†âŒŠ0.5 + { i 1âŠ¸+â†© â‹„ ğ•© - (F ğ•©) SolveâŠ(9â¥Š0) DF ğ•© } â€¢_while_ { (i<maxsteps) âˆ§ eps<âŒˆÂ´|F ğ•©} start
		x â‹ˆ âŒˆÂ´|F x
	} â€¢_while_ {eps<1âŠ‘ğ•©} @â€¿âˆ
}
